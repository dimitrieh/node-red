/**
 * Copyright JS Foundation and other contributors, http://js.foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 **/

// Mobile-First Responsive Design for Node-RED
// Touch-friendly, intelligent layout adaptations

// Breakpoints
$mobile-max: 767px;
$tablet-max: 1024px;
$desktop-min: 1025px;

// Touch-friendly sizes
$touch-target-min: 44px;
$touch-padding: 12px;

// Mobile Header Optimizations
@media only screen and (max-width: $mobile-max) {
    #red-ui-header {
        padding: 0 10px;
        height: 56px; // Increased for better touch
        
        .red-ui-header-toolbar .button {
            min-width: $touch-target-min;
            min-height: $touch-target-min;
            padding: $touch-padding;
            margin: 0 2px;
            font-size: 18px;
        }
        
        // Deploy button optimizations
        .red-ui-deploy-button {
            padding: $touch-padding 16px;
            font-size: 16px;
            font-weight: 600;
        }
        
        // Hide less critical header elements on mobile
        .red-ui-header-logo span {
            display: none !important;
        }
    }
}

// Mobile Palette - Transform to Overlay/Drawer
@media only screen and (max-width: $mobile-max) {
    #red-ui-palette {
        position: fixed;
        top: 56px; // Below header
        left: -180px; // Hidden by default
        width: 180px;
        z-index: 1000;
        height: calc(100vh - 56px);
        background: var(--red-ui-primary-background);
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
        transition: left 0.3s ease-in-out;
        
        &.mobile-open {
            left: 0;
        }
    }
    
    // Mobile palette toggle button
    .mobile-palette-toggle {
        position: fixed;
        top: 50%;
        left: 10px;
        transform: translateY(-50%);
        width: $touch-target-min;
        height: $touch-target-min;
        background: var(--red-ui-deploy-button-background);
        color: var(--red-ui-deploy-button-color);
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        z-index: 1001;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        
        &:hover {
            background: var(--red-ui-deploy-button-background-hover);
        }
    }
    
    // Palette search optimizations
    .red-ui-palette-search {
        height: 48px; // Increased for touch
        padding: 8px;
        
        input {
            height: 32px;
            padding: 8px 12px;
            font-size: 16px;
        }
    }
    
    // Node categories - more touch-friendly
    .red-ui-palette-header {
        padding: $touch-padding 10px;
        font-size: 16px;
        min-height: $touch-target-min;
        display: flex;
        align-items: center;
    }
    
    // Node items in palette
    .red-ui-palette-node {
        margin: 4px;
        min-width: $touch-target-min;
        min-height: $touch-target-min;
        
        .red-ui-palette-label {
            font-size: 14px;
        }
    }
}

// Mobile Workspace Adaptations
@media only screen and (max-width: $mobile-max) {
    #red-ui-workspace {
        left: 0 !important; // Full width
        right: 0 !important;
        top: 56px; // Below larger header
    }
    
    #red-ui-workspace-chart {
        top: 48px; // Below tabs
        
        // Larger touch targets for nodes
        .red-ui-flow-node {
            min-width: $touch-target-min;
            min-height: $touch-target-min;
        }
        
        // Node ports - larger for touch
        .red-ui-flow-port {
            r: 8; // SVG radius
        }
        
        .red-ui-flow-port-input,
        .red-ui-flow-port-output {
            r: 10;
        }
    }
    
    // Workspace tabs - touch friendly
    .red-ui-tabs {
        li {
            min-height: $touch-target-min;
            
            a {
                padding: $touch-padding 16px;
                font-size: 16px;
            }
        }
    }
}

// Mobile Sidebar - Transform to Bottom Sheet/Overlay
@media only screen and (max-width: $mobile-max) {
    #red-ui-sidebar {
        position: fixed;
        top: auto;
        bottom: -70vh; // Hidden by default (showing 30vh)
        left: 0;
        right: 0;
        width: 100%;
        height: 70vh;
        border-radius: 20px 20px 0 0;
        box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
        transition: bottom 0.3s ease-in-out;
        
        &.mobile-open {
            bottom: 0;
        }
        
        // Sidebar handle for swiping
        &:before {
            content: '';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background: var(--red-ui-secondary-text-color);
            border-radius: 2px;
        }
    }
    
    #red-ui-sidebar-content {
        top: 50px; // Space for handle
        padding: 0 20px;
    }
    
    // Sidebar tabs - horizontal scroll on mobile
    .red-ui-sidebar-tabs {
        display: flex;
        overflow-x: auto;
        white-space: nowrap;
        padding: 10px 20px;
        
        li {
            flex: 0 0 auto;
            margin-right: 10px;
            
            a {
                padding: $touch-padding 16px;
                min-height: $touch-target-min;
                display: flex;
                align-items: center;
            }
        }
    }
    
    // Hide sidebar separator on mobile
    #red-ui-sidebar-separator {
        display: none;
    }
}

// Tablet Optimizations (768px - 1024px)
@media only screen and (min-width: 768px) and (max-width: $tablet-max) {
    // Tablet header
    #red-ui-header {
        height: 52px; // Slightly larger than desktop
        
        .red-ui-header-toolbar .button {
            min-width: 40px;
            min-height: 40px;
            padding: 10px;
        }
    }
    
    // Tablet palette - narrower but visible
    #red-ui-palette {
        width: 160px;
        
        .red-ui-palette-header {
            padding: 10px 8px;
            min-height: 40px;
        }
    }
    
    // Tablet workspace
    #red-ui-workspace {
        left: 159px; // Account for narrower palette
        top: 52px;
    }
    
    // Tablet sidebar - narrower
    #red-ui-sidebar {
        width: 280px;
        
        #red-ui-sidebar-separator {
            right: 280px;
        }
    }
    
    #red-ui-workspace {
        right: 287px; // Account for narrower sidebar
    }
}

// Touch-friendly form controls across all mobile devices
@media only screen and (max-width: $tablet-max) {
    .red-ui-button,
    button {
        min-height: $touch-target-min;
        padding: $touch-padding 16px;
        font-size: 16px;
    }
    
    input,
    select,
    textarea {
        min-height: $touch-target-min;
        padding: $touch-padding;
        font-size: 16px; // Prevents zoom on iOS
    }
    
    // Dialog optimizations
    .red-ui-editor-dialog {
        margin: 10px;
        width: calc(100% - 20px) !important;
        max-height: calc(100vh - 20px);
        
        .form-row {
            margin-bottom: 20px; // More space between form elements
        }
        
        .red-ui-button {
            margin: 5px;
            min-width: 120px;
        }
    }
    
    // Menu optimizations
    .red-ui-menu,
    .red-ui-menu-dropdown {
        li a {
            padding: $touch-padding 20px;
            min-height: $touch-target-min;
            font-size: 16px;
        }
    }
    
    // Notification optimizations
    .red-ui-notification {
        margin: 10px;
        padding: 16px;
        font-size: 16px;
        
        .red-ui-notification-close {
            width: $touch-target-min;
            height: $touch-target-min;
        }
    }
}

// Landscape phone optimizations
@media only screen and (max-width: $mobile-max) and (orientation: landscape) {
    #red-ui-header {
        height: 48px; // Smaller in landscape to save space
    }
    
    #red-ui-workspace {
        top: 48px;
    }
    
    #red-ui-palette {
        top: 48px;
        height: calc(100vh - 48px);
    }
    
    #red-ui-sidebar {
        height: 50vh; // Smaller bottom sheet in landscape
        bottom: -40vh;
    }
}

// Accessibility improvements for mobile
@media only screen and (max-width: $tablet-max) {
    // Larger focus indicators
    *:focus {
        outline: 3px solid var(--red-ui-form-input-focus-color);
        outline-offset: 2px;
    }
    
    // High contrast mode support
    @media (prefers-contrast: high) {
        .red-ui-button,
        button {
            border: 2px solid currentColor;
        }
    }
    
    // Reduced motion support
    @media (prefers-reduced-motion: reduce) {
        * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }
}

// Dark mode optimizations for mobile
@media only screen and (max-width: $tablet-max) and (prefers-color-scheme: dark) {
    #red-ui-palette,
    #red-ui-sidebar {
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }
    
    .mobile-palette-toggle {
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.5);
    }
}