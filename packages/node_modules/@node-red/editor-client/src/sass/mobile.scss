/**
 * Copyright JS Foundation and other contributors, http://js.foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 **/

@use "mixins";

/* Mobile and Tablet Optimizations for Node-RED */

/* Touch-friendly base styles */
@media (pointer: coarse) {
    /* Increase touch target sizes for touchscreens */
    .red-ui-button,
    .red-ui-sidebar-tab,
    .red-ui-palette-category,
    .red-ui-palette-node {
        min-height: 44px; /* iOS minimum touch target */
        min-width: 44px;
    }
    
    /* Larger tap areas for important controls */
    #red-ui-header .red-ui-header-button {
        padding: 8px 12px;
        min-height: 44px;
    }
    
    /* Touch-friendly drag handles */
    #red-ui-sidebar-separator,
    #red-ui-palette:before {
        width: 12px;
    }
}

/* Mobile Portrait (phones) - 320px to 767px */
@media only screen and (max-width: 767px) {
    /* Hide sidebar and palette by default on mobile */
    #red-ui-sidebar {
        display: none;
    }
    
    #red-ui-palette {
        display: none;
    }
    
    /* Show panels when active class is added */
    body.red-ui-mobile-sidebar-open #red-ui-sidebar {
        display: block;
        position: fixed;
        top: var(--red-ui-header-height);
        right: 0;
        bottom: 0;
        width: 300px;
        z-index: 1000;
        box-shadow: -2px 0 8px rgba(0,0,0,0.2);
    }
    
    body.red-ui-mobile-palette-open #red-ui-palette {
        display: block;
        position: fixed;
        top: var(--red-ui-header-height);
        left: 0;
        bottom: 0;
        width: 280px;
        z-index: 1000;
        box-shadow: 2px 0 8px rgba(0,0,0,0.2);
    }
    
    /* Full-width workspace on mobile */
    #red-ui-workspace {
        left: 0;
        right: 0;
    }
    
    /* Mobile sidebar overlay */
    .red-ui-mobile-sidebar-open::before,
    .red-ui-mobile-palette-open::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 999;
    }
    
    /* Mobile navigation buttons */
    .red-ui-mobile-nav {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 1001;
        background: var(--red-ui-primary-background);
        padding: 8px;
        border-radius: 20px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.2);
        border: 1px solid var(--red-ui-primary-border-color);
    }
    
    .red-ui-mobile-nav-button {
        @include mixins.workspace-button;
        padding: 8px 12px;
        min-height: 44px;
        min-width: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        
        &.active {
            background: var(--red-ui-primary-text-color);
            color: var(--red-ui-primary-background);
        }
        
        i {
            font-size: 16px;
        }
    }
    
    /* Compact node palette for mobile */
    #red-ui-palette {
        width: 280px; /* Slightly wider for easier touch interaction */
    }
    
    .red-ui-palette-node {
        padding: 8px 12px;
        margin: 2px 4px;
        border-radius: 8px;
    }
    
    .red-ui-palette-category-header {
        padding: 12px 8px;
        font-size: 14px;
    }
    
    /* Compact sidebar for mobile */
    #red-ui-sidebar {
        width: 300px; /* Slightly smaller but still usable */
    }
    
    #red-ui-sidebar-tabs {
        ul {
            display: flex;
            justify-content: space-around;
            
            li {
                flex: 1;
                text-align: center;
                
                a {
                    padding: 12px 8px;
                    font-size: 12px;
                }
            }
        }
    }
    
    /* Hide resize handles on mobile */
    #red-ui-sidebar-separator,
    #red-ui-palette:before {
        display: none;
    }
    
    /* Larger flow tabs for mobile */
    .red-ui-tabs {
        li {
            padding: 0 16px;
            min-height: 44px;
            
            a {
                line-height: 44px;
                padding: 0 8px;
            }
        }
        
        .red-ui-tab-close {
            padding: 12px 8px;
        }
    }
}

/* Mobile Landscape (phones) - 568px to 812px width */
@media only screen and (max-width: 812px) and (orientation: landscape) {
    .red-ui-mobile-nav {
        left: 20px;
        transform: none;
        bottom: 50%;
        transform: translateY(50%);
        flex-direction: column;
        gap: 8px;
    }
    
    #red-ui-palette,
    #red-ui-sidebar {
        width: 250px; /* Narrower for landscape */
    }
}

/* Tablet Portrait - 768px to 1024px */
@media only screen and (min-width: 768px) and (max-width: 1024px) and (orientation: portrait) {
    /* Semi-collapsed panels for tablet */
    #red-ui-palette {
        width: 220px;
        
        .red-ui-palette-category-header {
            font-size: 13px;
            padding: 10px 6px;
        }
        
        .red-ui-palette-node {
            margin: 1px 3px;
            padding: 6px 8px;
        }
    }
    
    #red-ui-sidebar {
        width: 280px;
        
        #red-ui-sidebar-tabs ul li a {
            padding: 8px 6px;
            font-size: 11px;
        }
    }
    
    #red-ui-workspace {
        left: 220px;
        right: 280px;
    }
    
    /* Touch-friendly but smaller elements */
    .red-ui-button {
        min-height: 40px;
        padding: 6px 10px;
    }
}

/* Tablet Landscape - 1024px to 1366px */
@media only screen and (min-width: 1024px) and (max-width: 1366px) and (orientation: landscape) {
    /* Standard layout works well, just optimize touch targets */
    #red-ui-palette {
        width: 200px;
    }
    
    #red-ui-sidebar {
        width: 300px;
    }
    
    #red-ui-workspace {
        left: 200px;
        right: 300px;
    }
}

/* Touch-specific improvements */
@media (hover: none) and (pointer: coarse) {
    /* Remove hover effects on touch devices */
    .red-ui-palette-node:hover,
    .red-ui-button:hover,
    .red-ui-sidebar-tab:hover {
        background: inherit;
    }
    
    /* Add active states for touch feedback */
    .red-ui-palette-node:active,
    .red-ui-button:active,
    .red-ui-sidebar-tab:active {
        background: var(--red-ui-node-selected-color);
        transform: scale(0.95);
    }
    
    /* Increase scroll areas for touch scrolling */
    .red-ui-palette-scroll,
    #red-ui-sidebar-content {
        padding-bottom: 80px; /* Extra space for comfortable scrolling */
    }
    
    /* Touch-friendly drag indicators */
    .red-ui-palette-node {
        position: relative;
        
        &::after {
            content: '';
            position: absolute;
            top: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><circle cx="6" cy="6" r="1" fill="currentColor" opacity="0.5"/></svg>');
        }
    }
}

/* High DPI displays (Retina) */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .red-ui-palette-node,
    .red-ui-button,
    .red-ui-sidebar-tab {
        border-width: 0.5px; /* Thinner borders on high DPI */
    }
}

/* Accessibility improvements for mobile */
@media (prefers-reduced-motion: no-preference) {
    #red-ui-sidebar,
    #red-ui-palette {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
}

@media (prefers-reduced-motion: reduce) {
    #red-ui-sidebar,
    #red-ui-palette,
    .red-ui-mobile-nav-button {
        transition: none;
    }
}

/* Dark mode adjustments for mobile */
@media (prefers-color-scheme: dark) {
    .red-ui-mobile-nav {
        background: var(--red-ui-secondary-background);
        border-color: var(--red-ui-secondary-border-color);
        box-shadow: 0 2px 12px rgba(0,0,0,0.4);
    }
    
    .red-ui-mobile-sidebar-open::before,
    .red-ui-mobile-palette-open::before {
        background: rgba(0,0,0,0.7);
    }
}

/* Enhanced workspace support for touch */
@media (pointer: coarse) {
    #red-ui-workspace-chart {
        /* Enable better touch scrolling */
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
    }
    
    /* Improve node dragging on touch devices */
    .red-ui-flow-node {
        touch-action: manipulation;
    }
    
    /* Better touch targets for workspace elements */
    .red-ui-workspace-button {
        min-height: 44px;
        min-width: 44px;
        padding: 10px;
    }
}

/* Mobile workspace optimizations */
@media only screen and (max-width: 767px) {
    /* Larger workspace toolbar for mobile */
    #red-ui-workspace-toolbar {
        height: 50px; /* Increased from default */
        
        .red-ui-workspace-button {
            height: 44px;
            width: 44px;
            margin: 3px;
        }
    }
    
    /* Adjust workspace chart positioning for larger toolbar */
    #red-ui-workspace-chart {
        top: 50px; /* Adjusted for larger toolbar */
    }
    
    /* Mobile-friendly zoom controls */
    .red-ui-workspace-zoom-controls {
        bottom: 100px; /* Above mobile nav */
        right: 20px;
        
        .red-ui-workspace-button {
            width: 50px;
            height: 50px;
            margin: 5px 0;
            border-radius: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
    }
}

/* Tablet optimizations */
@media only screen and (min-width: 768px) and (max-width: 1024px) {
    .red-ui-workspace-button {
        min-height: 40px;
        min-width: 40px;
        padding: 8px;
    }
}

/* Print styles - hide mobile navigation */
@media print {
    .red-ui-mobile-nav,
    .red-ui-mobile-nav-button {
        display: none !important;
    }
}