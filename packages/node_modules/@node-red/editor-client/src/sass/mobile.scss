/**
 * Copyright JS Foundation and other contributors, http://js.foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 **/

// Mobile and tablet responsive optimizations
@use "mixins";

// Breakpoints for responsive design
$mobile-max: 767px;
$tablet-min: 768px;
$tablet-max: 1024px;
$desktop-min: 1025px;

// Touch-friendly minimum sizes
$min-touch-target: 44px;
$mobile-font-scale: 1.1;

// Mobile-specific optimizations (< 768px)
@media (max-width: #{$mobile-max}) {
  
  // Scale up base font size for better readability
  body {
    font-size: calc(var(--red-ui-primary-font-size) * #{$mobile-font-scale});
  }

  // Header optimizations
  #red-ui-header {
    .red-ui-header-toolbar {
      // Make Deploy button more prominent on mobile
      #red-ui-header-button-deploy {
        min-height: $min-touch-target;
        min-width: 80px;
        padding: 8px 16px;
        font-size: 16px;
        font-weight: 600;
      }

      // Improve touch targets for header buttons
      .red-ui-header-button {
        min-height: $min-touch-target;
        min-width: $min-touch-target;
        padding: 8px;
      }
    }
  }

  // Mobile palette optimizations
  #red-ui-palette {
    // Make palette narrower on mobile by default
    width: 50px !important;
    transition: width 0.3s ease-in-out;
    overflow: hidden;

    &:hover,
    &:focus-within,
    &.red-ui-palette-expanded {
      width: 200px !important; // Wider when expanded for better touch access
      z-index: 1000;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
    }

    // Touch-friendly palette items
    .red-ui-palette-node {
      min-height: $min-touch-target;
      margin: 2px;
      padding: 8px 4px;
      
      .red-ui-palette-label {
        font-size: 12px;
        line-height: 1.2;
      }
    }

    // Larger category headers for touch
    .red-ui-palette-header {
      min-height: $min-touch-target;
      padding: 12px 8px;
      font-size: 14px;
      font-weight: 600;

      i {
        font-size: 16px;
      }
    }

    // Improved search box
    .red-ui-palette-search {
      height: 50px;
      padding: 8px;

      input {
        font-size: 16px; // Prevent zoom on iOS
        padding: 12px 16px;
        min-height: 40px;
        border-radius: 8px;
      }
    }
  }

  // Hide sidebar by default on mobile, show as overlay when needed
  #red-ui-sidebar {
    right: -320px !important; // Move off-screen by default
    width: 320px !important;
    transition: right 0.3s ease-in-out;
    z-index: 1001;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);
    position: fixed !important; // Make it overlay

    &.red-ui-sidebar-open {
      right: 0 !important; // Slide in when opened
    }

    // Touch-friendly sidebar tabs
    .red-ui-sidebar-header {
      .red-ui-tabs {
        .red-ui-tab {
          min-height: $min-touch-target;
          padding: 12px 16px;
          font-size: 14px;

          a {
            padding: 8px 12px;
          }
        }
      }
    }
  }

  // Optimize workspace for mobile
  #red-ui-workspace {
    // Adjust for collapsed palette and hidden sidebar
    left: 50px !important; // Match collapsed palette width
    right: 0 !important;    // Full width when sidebar hidden

    &.red-ui-workspace-palette-expanded {
      left: 200px !important; // Account for expanded palette
    }

    &.red-ui-workspace-sidebar-open {
      right: 320px !important; // Account for sidebar overlay
    }
  }

  // Adjust main container for better mobile layout
  #red-ui-main-container {
    // Ensure proper spacing for mobile
    .red-ui-editor-stack {
      left: 50px !important;
      right: 0 !important;
    }
  }

  // Specifically target the editor stack for workspace layout
  .red-ui-editor-stack {
    left: 50px !important;
    right: 0 !important;
    
    // When palette is expanded
    &.red-ui-palette-expanded,
    .red-ui-palette-expanded & {
      left: 200px !important;
    }
  }

  // Improve workspace tabs for touch
  .red-ui-workspace-tabs {
    .red-ui-tab {
      min-height: $min-touch-target;
      padding: 12px 20px;
      font-size: 16px;

      .red-ui-tab-close {
        min-width: 32px;
        min-height: 32px;
        right: 8px;
      }
    }

    // Add new tab button
    .red-ui-tab-new {
      min-height: $min-touch-target;
      min-width: $min-touch-target;
    }
  }

  // Touch-friendly workspace toolbar
  .red-ui-workspace-toolbar {
    .red-ui-workspace-button {
      min-height: $min-touch-target;
      min-width: $min-touch-target;
      padding: 10px;
      margin: 2px;

      i {
        font-size: 18px;
      }
    }
  }

  // Mobile-specific utility classes
  .red-ui-mobile-hide {
    display: none !important;
  }

  .red-ui-mobile-show {
    display: block !important;
  }

  // Touch-friendly form elements
  .red-ui-form-row {
    margin-bottom: 16px;

    label {
      font-size: 16px;
      margin-bottom: 8px;
      display: block;
    }

    input[type="text"],
    input[type="password"],
    input[type="email"],
    input[type="number"],
    textarea,
    select {
      font-size: 16px; // Prevent zoom on iOS
      padding: 12px 16px;
      min-height: $min-touch-target;
    }
  }

  // Touch-friendly buttons
  button,
  .red-ui-button {
    min-height: $min-touch-target;
    padding: 12px 20px;
    font-size: 16px;
    border-radius: 8px;
  }
}

// Tablet optimizations (768px - 1024px)
@media (min-width: #{$tablet-min}) and (max-width: #{$tablet-max}) {
  
  // Tablet palette - wider but not full desktop width
  #red-ui-palette {
    width: 220px;

    .red-ui-palette-node {
      min-height: 40px;
      padding: 6px 4px;
      margin: 1px;
    }

    .red-ui-palette-header {
      min-height: 40px;
      padding: 10px 8px;
    }
  }

  // Tablet sidebar - keep visible but optimize width
  #red-ui-sidebar {
    width: 280px;

    .red-ui-tab {
      min-height: 40px;
      padding: 10px 14px;
    }
  }

  // Adjust workspace for tablet
  #red-ui-workspace {
    left: 220px;
    right: 280px;
  }

  // Touch-friendly but not as large as mobile
  .red-ui-workspace-tabs .red-ui-tab {
    min-height: 40px;
    padding: 10px 16px;
  }

  // Tablet form elements
  button,
  .red-ui-button {
    min-height: 40px;
    padding: 10px 18px;
  }

  input[type="text"],
  input[type="password"],
  input[type="email"],
  input[type="number"],
  textarea,
  select {
    min-height: 40px;
    padding: 10px 14px;
    font-size: 15px;
  }
}

// Add toggle buttons for mobile palette and sidebar
@media (max-width: #{$mobile-max}) {
  
  // Palette toggle button
  .red-ui-palette-toggle {
    position: fixed;
    top: 60px; // Below header
    left: 10px;
    z-index: 1002;
    background: var(--red-ui-primary-background);
    border: 2px solid var(--red-ui-primary-border-color);
    border-radius: 8px;
    width: $min-touch-target;
    height: $min-touch-target;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;

    &:hover,
    &:focus {
      background: var(--red-ui-secondary-background);
      transform: scale(1.05);
    }

    i {
      font-size: 18px;
      color: var(--red-ui-primary-text-color);
    }
  }

  // Sidebar toggle button
  .red-ui-sidebar-toggle {
    position: fixed;
    top: 60px; // Below header
    right: 10px;
    z-index: 1002;
    background: var(--red-ui-primary-background);
    border: 2px solid var(--red-ui-primary-border-color);
    border-radius: 8px;
    width: $min-touch-target;
    height: $min-touch-target;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;

    &:hover,
    &:focus {
      background: var(--red-ui-secondary-background);
      transform: scale(1.05);
    }

    i {
      font-size: 18px;
      color: var(--red-ui-primary-text-color);
    }
  }

  // Overlay backdrop for when panels are open
  .red-ui-mobile-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;

    &.red-ui-mobile-backdrop-active {
      opacity: 1;
      visibility: visible;
    }
  }
}

// Improve touch scrolling on mobile devices
@media (max-width: #{$tablet-max}) {
  .red-ui-palette-scroll,
  .red-ui-sidebar-content,
  .red-ui-workspace-tabs-scroll {
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
  }

  // Hide scrollbars on mobile for cleaner appearance
  @media (max-width: #{$mobile-max}) {
    .red-ui-palette-scroll,
    .red-ui-sidebar-content {
      scrollbar-width: none;
      -ms-overflow-style: none;
      
      &::-webkit-scrollbar {
        display: none;
      }
    }
  }
}