/**
 * Mobile and Tablet Responsive Enhancements for Node-RED
 * Intelligent responsive design for touch devices
 */

// Breakpoints
$mobile-max: 767px;
$tablet-min: 768px;
$tablet-max: 1024px;
$desktop-min: 1025px;

// Touch target sizes (iOS HIG and Material Design)
$touch-target-min: 44px;
$touch-target-comfortable: 48px;

// Base responsive utilities
.red-ui-hidden-mobile {
    @media (max-width: $mobile-max) {
        display: none !important;
    }
}

.red-ui-hidden-tablet {
    @media (min-width: $tablet-min) and (max-width: $tablet-max) {
        display: none !important;
    }
}

.red-ui-hidden-desktop {
    @media (min-width: $desktop-min) {
        display: none !important;
    }
}

// Mobile-first approach
@media (max-width: $mobile-max) {
    // Core layout adjustments
    #red-ui-workspace {
        left: 0 !important;
        right: 0 !important;
        top: var(--red-ui-header-height, 40px) !important;
        bottom: 80px !important; // Space for mobile nav
    }

    #red-ui-palette,
    #red-ui-sidebar {
        position: fixed !important;
        top: var(--red-ui-header-height, 40px) !important;
        bottom: 80px !important;
        z-index: 1000 !important;
        transform: translateX(-100%) !important;
        transition: transform 0.3s ease-in-out !important;
        box-shadow: 2px 0 12px rgba(0,0,0,0.15) !important;
        
        &.mobile-visible {
            transform: translateX(0) !important;
        }
    }

    #red-ui-palette {
        left: 0 !important;
        width: min(300px, 85vw) !important;
        
        &.mobile-visible {
            transform: translateX(0) !important;
        }
    }

    #red-ui-sidebar {
        right: 0 !important;
        width: min(320px, 90vw) !important;
        left: auto !important;
        
        &.mobile-visible {
            transform: translateX(0) !important;
        }
    }

    // Header adjustments for mobile
    #red-ui-header {
        height: 48px !important;
        padding: 0 8px !important;
        
        .red-ui-header-button {
            min-width: $touch-target-min !important;
            min-height: $touch-target-min !important;
            padding: 8px !important;
            margin: 2px !important;
        }
    }

    // Deploy button mobile optimization
    #red-ui-deploy-button {
        min-width: 80px !important;
        height: $touch-target-min !important;
        font-size: 14px !important;
        padding: 0 12px !important;
    }

    // Touch-friendly palette nodes
    .red-ui-palette-node {
        min-height: $touch-target-comfortable !important;
        margin: 4px 8px !important;
        padding: 12px !important;
        border-radius: 6px !important;
        
        &:active {
            transform: scale(0.95) !important;
            transition: transform 0.1s ease !important;
        }
    }

    // Sidebar optimizations
    .red-ui-sidebar-tab {
        min-height: $touch-target-comfortable !important;
        line-height: $touch-target-comfortable !important;
        font-size: 16px !important;
        padding: 0 16px !important;
    }

    // Mobile navigation bar
    .red-ui-mobile-nav {
        position: fixed !important;
        bottom: 20px !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        background: var(--red-ui-primary-background, #ffffff) !important;
        border: 1px solid var(--red-ui-primary-border-color, #d3d3d3) !important;
        border-radius: 24px !important;
        padding: 8px 16px !important;
        box-shadow: 0 4px 16px rgba(0,0,0,0.15), 0 2px 8px rgba(0,0,0,0.1) !important;
        z-index: 1001 !important;
        display: flex !important;
        gap: 12px !important;
        align-items: center !important;
        backdrop-filter: blur(10px) !important;
        
        .nav-button {
            background: none !important;
            border: none !important;
            min-width: $touch-target-min !important;
            min-height: $touch-target-min !important;
            border-radius: 50% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 18px !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            
            &:hover, &:focus {
                background: var(--red-ui-node-selected-color, rgba(0,123,255,0.1)) !important;
                transform: scale(1.05) !important;
            }
            
            &:active {
                transform: scale(0.95) !important;
                background: var(--red-ui-node-selected-color, rgba(0,123,255,0.2)) !important;
            }
            
            &.active {
                background: var(--red-ui-deploy-button-color, #8f0000) !important;
                color: white !important;
                
                &:hover {
                    background: var(--red-ui-deploy-button-color, #8f0000) !important;
                    opacity: 0.9 !important;
                }
            }
        }
    }

    // Mobile overlay for panels
    .red-ui-mobile-overlay {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        background: rgba(0,0,0,0.5) !important;
        z-index: 999 !important;
        transition: opacity 0.3s ease !important;
        backdrop-filter: blur(2px) !important;
    }

    // Workspace chart enhancements for touch
    #red-ui-workspace-chart {
        -webkit-overflow-scrolling: touch !important;
        scroll-behavior: smooth !important;
        touch-action: pan-x pan-y !important;
        
        // Enhanced scrollbars for mobile
        &::-webkit-scrollbar {
            width: 8px !important;
            height: 8px !important;
        }
        
        &::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1) !important;
            border-radius: 4px !important;
        }
        
        &::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.3) !important;
            border-radius: 4px !important;
            
            &:hover {
                background: rgba(0,0,0,0.5) !important;
            }
        }
    }
}

// Tablet-specific optimizations
@media (min-width: $tablet-min) and (max-width: $tablet-max) {
    #red-ui-workspace {
        left: 0 !important;
        right: 0 !important;
    }
    
    #red-ui-palette,
    #red-ui-sidebar {
        position: fixed !important;
        z-index: 100 !important;
        box-shadow: 0 0 16px rgba(0,0,0,0.15) !important;
        border-radius: 8px !important;
        
        &:not(.tablet-minimized) {
            top: 60px !important;
            height: calc(100vh - 120px) !important;
        }
        
        &.tablet-minimized {
            height: 48px !important;
            overflow: hidden !important;
            cursor: pointer !important;
            
            .red-ui-palette-content,
            .red-ui-sidebar-content {
                display: none !important;
            }
        }
    }
    
    #red-ui-palette {
        left: 20px !important;
        width: 220px !important;
    }
    
    #red-ui-sidebar {
        right: 20px !important;
        width: 280px !important;
    }
    
    // Touch enhancements for tablet
    .red-ui-palette-node,
    .red-ui-sidebar-tab,
    .red-ui-button {
        min-height: $touch-target-min !important;
        
        &:active {
            transform: scale(0.98) !important;
            transition: transform 0.1s ease !important;
        }
    }
}

// Touch device enhancements (any device with touch)
@media (pointer: coarse) {
    // Ensure all interactive elements meet touch guidelines
    .red-ui-button,
    .red-ui-header-button,
    .red-ui-palette-node,
    .red-ui-sidebar-tab,
    .red-ui-tab,
    button {
        min-height: $touch-target-min !important;
        min-width: $touch-target-min !important;
        touch-action: manipulation !important;
        
        &:active {
            opacity: 0.8 !important;
        }
    }
    
    // Enhanced drag feedback for touch
    .red-ui-palette-node {
        &.ui-draggable-dragging {
            transform: scale(1.1) !important;
            z-index: 2000 !important;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3) !important;
        }
    }
    
    // Better node selection for touch
    .red-ui-workspace-chart {
        .red_ui_flow_node {
            &:active {
                filter: brightness(1.1) !important;
            }
        }
    }
}

// Landscape mobile adjustments
@media (max-width: $mobile-max) and (orientation: landscape) {
    .red-ui-mobile-nav {
        bottom: 10px !important;
    }
    
    #red-ui-workspace {
        bottom: 60px !important;
    }
    
    #red-ui-palette,
    #red-ui-sidebar {
        bottom: 60px !important;
        max-height: calc(100vh - 100px) !important;
    }
}

// Accessibility enhancements
@media (prefers-reduced-motion: reduce) {
    * {
        transition-duration: 0.01ms !important;
        animation-duration: 0.01ms !important;
    }
}

// High contrast support
@media (prefers-contrast: high) {
    .red-ui-mobile-nav {
        border-width: 2px !important;
        box-shadow: 0 4px 16px rgba(0,0,0,0.4) !important;
        
        .nav-button {
            border: 1px solid currentColor !important;
        }
    }
    
    .red-ui-palette-node {
        border-width: 2px !important;
    }
}