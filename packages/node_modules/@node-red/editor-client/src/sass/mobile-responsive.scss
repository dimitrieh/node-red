/**
 * Mobile & Tablet Responsive Optimizations for Node-RED
 * Provides intelligent touch-friendly design with content prioritization
 */

// Mobile-first breakpoints
$mobile-portrait: 480px;
$mobile-landscape: 576px; 
$tablet-portrait: 768px;
$tablet-landscape: 992px;
$desktop: 1200px;

// Touch-friendly sizing
$touch-target-min: 44px;
$touch-target-comfortable: 48px;
$touch-spacing: 16px;

/* ==========================================================================
   Base Mobile Optimizations
   ========================================================================== */

@media (max-width: #{$tablet-portrait}) {
    
    // Base touch-friendly adjustments
    .red-ui-editor {
        // Improve text rendering on mobile
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        
        // Prevent zoom on input focus
        font-size: 16px;
    }
    
    // Ensure minimum touch targets throughout
    button, .button, a[role="button"], 
    input[type="button"], input[type="submit"], 
    .red-ui-button, .red-ui-tab-button {
        min-height: $touch-target-min;
        min-width: $touch-target-min;
        padding: 12px 16px;
    }
}

/* ==========================================================================
   Header Mobile Optimizations  
   ========================================================================== */

@media (max-width: #{$tablet-portrait}) {
    
    #red-ui-header {
        // Increase header height for better touch targets
        height: 56px !important;
        padding: 4px 12px;
        
        // Optimize logo area
        .red-ui-header-logo {
            font-size: 24px;
            
            img {
                height: 28px;
            }
            
            span {
                font-size: 14px !important;
            }
        }
        
        // Make header buttons touch-friendly
        .button {
            min-height: $touch-target-min;
            min-width: $touch-target-min;
            padding: 8px 12px;
            margin: 0 2px;
            font-size: 18px;
        }
        
        // Optimize deploy button for mobile
        .red-ui-deploy-button {
            padding: 8px 16px;
            font-size: 16px;
            min-height: $touch-target-min;
            
            .red-ui-deploy-button-content > img {
                margin-right: 6px;
                height: 18px;
            }
        }
        
        // Add mobile hamburger menu for palette/sidebar toggle
        .red-ui-mobile-menu-button {
            display: block !important;
            min-height: $touch-target-min;
            min-width: $touch-target-min;
            padding: 8px;
            background: none;
            border: none;
            color: var(--red-ui-header-menu-color);
            font-size: 20px;
            cursor: pointer;
            
            &:hover {
                background: var(--red-ui-header-menu-item-hover);
            }
        }
    }
    
    // Adjust main container for new header height
    #red-ui-main-container {
        top: 56px;
    }
}

@media (max-width: #{$mobile-landscape}) {
    
    #red-ui-header {
        // Further compress for mobile
        --red-ui-header-height: 50px;
        padding: 0 8px;
        
        .red-ui-header-logo {
            font-size: 20px;
            
            img {
                height: 24px;
            }
        }
        
        .button {
            padding: 6px 8px;
            margin: 0 1px;
            min-width: 40px;
        }
        
        // Prioritize deploy button on small screens
        .red-ui-deploy-button {
            padding: 6px 12px;
            font-weight: 600;
        }
    }
}

/* ==========================================================================
   Main Layout Mobile Adaptations
   ========================================================================== */

@media (max-width: #{$tablet-portrait}) {
    
    #red-ui-main-container {
        // Adjust for increased header height
        top: 56px;
    }
    
    // Mobile-specific layout adjustments
    #red-ui-palette {
        // Make palette more compact and touch-friendly on mobile
        width: 220px;
        transition: transform 0.3s ease, width 0.3s ease;
        z-index: 100;
        
        &.mobile-hidden {
            transform: translateX(-100%);
        }
    }
    
    #red-ui-workspace {
        // Adjust workspace for mobile palette behavior
        transition: left 0.3s ease;
        
        &.palette-hidden {
            left: 0;
        }
    }
    
    #red-ui-sidebar {
        // Improve sidebar usability on mobile
        width: 300px;
        transition: transform 0.3s ease;
        z-index: 101;
        
        &.mobile-hidden {
            transform: translateX(100%);
        }
    }
    
    // Mobile overlay for when panels are open
    .red-ui-mobile-overlay {
        display: none;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99;
        
        &.active {
            display: block;
        }
    }
}

/* ==========================================================================
   Palette Mobile Optimizations
   ========================================================================== */

@media (max-width: #{$tablet-portrait}) {
    
    #red-ui-palette {
        
        // Touch-friendly palette categories
        .red-ui-palette-category {
            
            .red-ui-palette-header {
                min-height: $touch-target-min;
                padding: 12px 10px;
                font-size: 16px;
                
                // Larger category toggle
                .red-ui-palette-category-icon {
                    width: 20px;
                    height: 20px;
                    margin-right: 8px;
                }
            }
        }
        
        // Touch-friendly palette nodes
        .red-ui-palette-node {
            min-height: $touch-target-comfortable;
            padding: 10px 8px;
            margin: 4px 0;
            
            // Improve text visibility
            .red-ui-palette-label {
                font-size: 14px;
                line-height: 1.4;
                font-weight: 500;
            }
        }
        
        // Optimize search box
        .red-ui-palette-search {
            input {
                height: $touch-target-min;
                padding: 8px 12px;
                font-size: 16px; // Prevent zoom on iOS
            }
        }
    }
}

@media (max-width: #{$mobile-landscape}) {
    
    #red-ui-palette {
        // Consider overlay mode for very small screens
        position: absolute;
        z-index: 100;
        background: var(--red-ui-palette-background);
        border-right: 2px solid var(--red-ui-palette-border);
        
        &.mobile-overlay {
            top: 0;
            bottom: 0;
            left: -100%;
            width: 280px;
            transition: left 0.3s ease;
            
            &.open {
                left: 0;
                box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            }
        }
    }
}

/* ==========================================================================
   Workspace Mobile Optimizations
   ========================================================================== */

@media (max-width: #{$tablet-portrait}) {
    
    #red-ui-workspace {
        // Optimize for touch gestures
        touch-action: pan-x pan-y;
        
        // Improve node visibility on small screens
        .red-ui-flow-node {
            // Slightly larger nodes on touch devices
            min-width: 60px;
            min-height: 40px;
        }
        
        // Touch-friendly connection points
        .red-ui-flow-port {
            width: 16px;
            height: 16px;
        }
    }
    
    // Workspace toolbar optimizations
    .red-ui-workspace-toolbar {
        
        .red-ui-workspace-button {
            min-height: $touch-target-min;
            min-width: $touch-target-min;
            padding: 8px;
            margin: 4px 2px;
        }
    }
}

/* ==========================================================================
   Sidebar Mobile Optimizations
   ========================================================================== */

@media (max-width: #{$tablet-portrait}) {
    
    #red-ui-sidebar {
        
        // Touch-friendly tabs
        .red-ui-sidebar-header {
            
            .red-ui-tabs {
                .red-ui-tab {
                    min-height: $touch-target-min;
                    padding: 12px 16px 8px;
                    font-size: 14px;
                    
                    // Larger tab icons
                    .fa {
                        font-size: 16px;
                        margin-bottom: 4px;
                    }
                }
            }
        }
        
        // Optimize sidebar content
        .red-ui-sidebar-content {
            padding: 16px 12px;
            
            // Better spacing for touch
            .red-ui-info-table {
                th, td {
                    padding: 8px 12px;
                    font-size: 14px;
                }
            }
        }
    }
}

@media (max-width: #{$mobile-landscape}) {
    
    #red-ui-sidebar {
        // Full-screen overlay on mobile
        position: absolute;
        top: 0;
        bottom: 0;
        right: -100%;
        width: 90%;
        max-width: 320px;
        z-index: 110;
        background: var(--red-ui-sidebar-background);
        transition: right 0.3s ease;
        
        &.mobile-overlay {
            &.open {
                right: 0;
                box-shadow: -2px 0 10px rgba(0,0,0,0.3);
            }
        }
    }
}

/* ==========================================================================
   Form Controls Mobile Optimizations
   ========================================================================== */

@media (max-width: #{$tablet-portrait}) {
    
    // Touch-friendly form elements
    .red-ui-editor-dialog,
    .red-ui-tray {
        
        input[type="text"],
        input[type="password"], 
        input[type="email"],
        input[type="number"],
        select,
        textarea {
            min-height: $touch-target-min;
            padding: 12px 16px;
            font-size: 16px; // Prevent zoom on iOS
            border-radius: 6px;
        }
        
        // Touch-friendly buttons
        .red-ui-button {
            min-height: $touch-target-min;
            padding: 12px 24px;
            font-size: 16px;
            margin: 8px 4px;
        }
        
        // Improve checkbox/radio sizing
        input[type="checkbox"],
        input[type="radio"] {
            width: 20px;
            height: 20px;
            margin: 4px 8px 4px 0;
        }
    }
}

/* ==========================================================================
   Menu & Popover Mobile Optimizations
   ========================================================================== */

@media (max-width: #{$tablet-portrait}) {
    
    .red-ui-menu,
    .red-ui-popover {
        
        // Touch-friendly menu items
        li a {
            min-height: $touch-target-min;
            padding: 12px 20px;
            font-size: 16px;
            
            // Larger icons in menus
            .fa {
                font-size: 18px;
                margin-right: 12px;
                width: 20px;
                text-align: center;
            }
        }
        
        // Better spacing between menu items
        li + li {
            border-top: 1px solid var(--red-ui-menu-divider-color);
        }
    }
    
    // Context menu optimizations
    .red-ui-menu-dropdown {
        min-width: 200px;
        font-size: 16px;
        
        li a {
            padding: 14px 20px;
        }
    }
}

/* ==========================================================================
   Typography Mobile Optimizations
   ========================================================================== */

@media (max-width: #{$tablet-portrait}) {
    
    .red-ui-editor {
        // Optimize text rendering
        line-height: 1.5;
        
        // Improve readability
        h1, .h1 { font-size: 24px; line-height: 1.3; }
        h2, .h2 { font-size: 20px; line-height: 1.4; }
        h3, .h3 { font-size: 18px; line-height: 1.4; }
        h4, .h4 { font-size: 16px; line-height: 1.4; }
        h5, .h5 { font-size: 15px; line-height: 1.4; }
        h6, .h6 { font-size: 14px; line-height: 1.4; }
        
        p, div, span {
            font-size: 15px;
            line-height: 1.5;
        }
        
        // Better code readability on mobile
        code, .red-ui-font-code {
            font-size: 14px;
            line-height: 1.4;
            padding: 2px 4px;
            border-radius: 3px;
            word-wrap: break-word;
        }
        
        pre {
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    }
}

/* ==========================================================================
   Accessibility & Touch Enhancements
   ========================================================================== */

@media (max-width: #{$tablet-portrait}) {
    
    // Enhanced focus indicators for touch navigation
    .red-ui-editor {
        
        *:focus {
            outline: 3px solid var(--red-ui-form-input-focus-color);
            outline-offset: 2px;
        }
        
        // Touch feedback for interactive elements
        .red-ui-button,
        .button,
        button {
            transition: all 0.15s ease;
            
            &:active {
                transform: scale(0.98);
                background-color: var(--red-ui-button-background-active);
            }
        }
        
        // Improve tap targets
        a, button, input, select, textarea, 
        .red-ui-tab, .red-ui-palette-node, 
        .red-ui-menu-item {
            // Ensure adequate spacing between touch targets
            margin: 2px;
            
            // Add visual touch feedback
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
        }
    }
}

/* ==========================================================================
   Landscape Orientation Optimizations
   ========================================================================== */

@media (max-width: #{$tablet-landscape}) and (orientation: landscape) {
    
    // Optimize for landscape mobile usage
    #red-ui-header {
        --red-ui-header-height: 46px;
        padding: 0 8px;
        
        .button {
            padding: 4px 8px;
            font-size: 16px;
        }
    }
    
    // Use more horizontal space in landscape
    #red-ui-palette {
        width: 200px;
    }
    
    #red-ui-sidebar {
        width: 240px;
    }
    
    // Compact form layouts in landscape
    .red-ui-editor-dialog .form-row {
        margin-bottom: 12px;
        
        label {
            width: 30%;
            display: inline-block;
            vertical-align: top;
            margin-bottom: 4px;
        }
        
        input, select, textarea {
            width: 68%;
        }
    }
}

/* ==========================================================================
   Dark Mode Mobile Enhancements
   ========================================================================== */

@media (max-width: #{$tablet-portrait}) and (prefers-color-scheme: dark) {
    
    // Enhanced contrast for mobile dark mode
    .red-ui-editor {
        
        // Improve text contrast on dark backgrounds
        color: rgba(255, 255, 255, 0.95);
        
        // Better button visibility in dark mode
        .red-ui-button {
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        // Enhanced focus indicators for dark mode
        *:focus {
            outline-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }
    }
}

/* ==========================================================================
   Print Optimizations for Mobile
   ========================================================================== */

@media print {
    
    // Hide interactive elements when printing from mobile
    #red-ui-header,
    #red-ui-palette,
    #red-ui-sidebar,
    .red-ui-workspace-toolbar {
        display: none !important;
    }
    
    // Full width for workspace when printing
    #red-ui-workspace {
        left: 0 !important;
        right: 0 !important;
    }
}