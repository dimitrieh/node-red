/**
 * Mobile-First Responsive Design for Node-RED
 * Optimized for touch interactions and mobile/tablet usage
 */

// Breakpoints
$mobile-max: 480px;
$tablet-max: 768px;
$desktop-min: 769px;

// Touch target sizing (minimum 44px for accessibility)
$touch-target-min: 44px;
$touch-target-comfort: 48px;

// Mobile-first responsive improvements
@media screen and (max-width: $tablet-max) {
  
  // ===== HEADER OPTIMIZATIONS =====
  #red-ui-header {
    padding: 0 8px; // Reduce horizontal padding
    
    .red-ui-header-logo {
      span {
        font-size: 14px !important; // Smaller font for mobile
      }
    }
    
    .button {
      min-width: $touch-target-min; // Touch-friendly size
      min-height: $touch-target-min;
      padding: 0 8px; // Reduce padding
      margin: 0 2px; // Tighter spacing
    }
    
    .red-ui-deploy-button {
      min-height: $touch-target-min;
      padding: 8px 16px;
      font-weight: 600;
    }
  }
  
  // ===== PALETTE MOBILE OPTIMIZATIONS =====
  #red-ui-palette {
    width: 160px; // Narrower on tablets
    
    .red-ui-palette-node {
      min-height: $touch-target-min; // Touch-friendly nodes
      margin: 2px 0; // Better spacing
      
      .red-ui-palette-label {
        font-size: 12px; // Smaller text
        padding: 8px 4px; // More vertical padding
      }
      
      .red-ui-palette-icon-fa {
        font-size: 18px; // Larger icons for touch
      }
    }
  }
  
  // ===== SIDEBAR OPTIMIZATIONS =====
  #red-ui-sidebar {
    .red-ui-sidebar-header {
      .red-ui-tab {
        min-width: $touch-target-min;
        min-height: $touch-target-min;
        padding: 8px;
        
        .red-ui-tab-label {
          font-size: 12px;
        }
      }
    }
    
    .red-ui-sidebar-content {
      padding: 8px; // More comfortable padding
    }
  }
  
  // ===== WORKSPACE OPTIMIZATIONS =====
  #red-ui-workspace {
    .red-ui-workspace-toolbar {
      .button {
        min-width: $touch-target-min;
        min-height: $touch-target-min;
      }
    }
  }
  
  // ===== FORM IMPROVEMENTS =====
  .red-ui-editor-dialog {
    input[type="text"],
    input[type="number"],
    input[type="password"],
    textarea,
    select {
      min-height: $touch-target-min;
      font-size: 16px; // Prevent zoom on iOS
      padding: 8px 12px;
    }
    
    .red-ui-button,
    button {
      min-height: $touch-target-min;
      min-width: $touch-target-min;
      padding: 8px 16px;
      font-size: 14px;
    }
  }
}

// ===== MOBILE-SPECIFIC OPTIMIZATIONS =====
@media screen and (max-width: $mobile-max) {
  
  // Hide secondary UI elements on small screens
  #red-ui-header {
    .red-ui-header-logo span:not(:first-child) {
      display: none; // Hide "Node-RED" text, keep logo only
    }
  }
  
  // Collapsible palette for mobile
  #red-ui-palette {
    width: 40px; // Collapsed by default on mobile
    overflow: hidden;
    
    &.red-ui-palette-expanded {
      width: 200px; // Expanded width
      z-index: 1000;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.2);
    }
    
    .red-ui-palette-search {
      display: none; // Hide search on collapsed state
    }
    
    &.red-ui-palette-expanded .red-ui-palette-search {
      display: block;
    }
    
    .red-ui-palette-node {
      .red-ui-palette-label {
        display: none; // Hide labels when collapsed
      }
    }
    
    &.red-ui-palette-expanded .red-ui-palette-node .red-ui-palette-label {
      display: block;
    }
  }
  
  // Mobile-friendly sidebar
  #red-ui-sidebar {
    // Overlay mode for mobile
    position: fixed;
    right: -300px; // Hidden by default
    width: 300px;
    top: var(--red-ui-header-height);
    bottom: 0;
    z-index: 1000;
    transition: right 0.3s ease-in-out;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);
    
    &.red-ui-sidebar-open {
      right: 0; // Show when opened
    }
  }
  
  // Adjust main container for mobile layout
  #red-ui-main-container {
    left: 40px; // Account for collapsed palette
    
    .red-ui-palette-expanded ~ & {
      left: 200px; // Account for expanded palette
    }
  }
  
  // Mobile workspace adjustments
  #red-ui-workspace {
    // Add mobile-specific touch interactions
    touch-action: pan-x pan-y; // Allow panning
    
    .red-ui-workspace-chart {
      // Larger touch targets for nodes
      .red-ui-flow-node {
        min-width: $touch-target-comfort;
        min-height: 32px;
      }
    }
  }
  
  // Mobile dialog improvements
  .red-ui-dialog {
    margin: 10px;
    max-width: calc(100vw - 20px);
    max-height: calc(100vh - 20px);
  }
}

// ===== TOUCH INTERACTION IMPROVEMENTS =====
@media (hover: none) and (pointer: coarse) {
  // Touch device specific styles
  
  .red-ui-palette-node:hover {
    // Remove hover effects on touch devices
    background: var(--red-ui-secondary-background);
  }
  
  .red-ui-palette-node:active {
    // Add active/pressed state for touch feedback
    background: var(--red-ui-secondary-background-selected);
    transform: scale(0.98);
    transition: transform 0.1s ease;
  }
  
  .button:active,
  .red-ui-button:active {
    // Touch feedback for buttons
    transform: scale(0.95);
    transition: transform 0.1s ease;
  }
  
  // Increase touch targets for small UI elements
  .red-ui-sidebar-header .red-ui-tab,
  .red-ui-workspace-toolbar .button,
  .red-ui-palette-header {
    min-height: $touch-target-comfort;
    padding: 8px;
  }
}

// ===== ACCESSIBILITY IMPROVEMENTS =====
@media (prefers-reduced-motion: reduce) {
  * {
    transition: none !important;
    animation: none !important;
  }
}

// High contrast mode support
@media (prefers-contrast: high) {
  #red-ui-palette {
    border-right: 2px solid var(--red-ui-primary-border-color);
  }
  
  .red-ui-palette-node {
    border: 1px solid var(--red-ui-secondary-border-color);
    margin: 4px 2px;
  }
}

// ===== ORIENTATION HANDLING =====
@media screen and (orientation: landscape) and (max-height: 500px) {
  // Landscape phone optimizations
  #red-ui-header {
    height: 36px; // Smaller header in landscape
  }
  
  #red-ui-main-container {
    top: 36px;
  }
  
  #red-ui-palette {
    &:not(.red-ui-palette-expanded) {
      width: 32px; // Even more compact
    }
  }
}