;RED.floatingWindows=function(){var a=null,s={},z=1000;function createFloatingWindow(o){var i=o.id||'floating-'+Date.now(),w=$('<div class="red-ui-floating-window '+(o.className||'')+'" id="'+i+'">'),h=$('<div class="red-ui-floating-window-header">'),t=$('<span class="red-ui-floating-window-title">').text(o.title||'Window'),c=$('<div class="red-ui-floating-window-controls">'),m=$('<button title="Minimize">âˆ’</button>');m.on('click',function(){toggleMinimize(w)}),c.append(m),h.append(t,c);var n=$('<div class="red-ui-floating-window-content">');o.content&&n.append(o.content),w.append(h,n),w.css({left:o.x||20,top:o.y||60,width:o.width||300,height:o.height||400}),$('#red-ui-workspace').append(w),makeDraggable(w,h),makeResizable(w),w.on('mousedown',function(){setActiveWindow(w)}),s[i]={element:w,options:o,minimized:!1},setActiveWindow(w);return{id:i,element:w,content:n,setTitle:function(title){w.find('.red-ui-floating-window-title').text(title)},setSize:function(width,height){w.css({width:width,height:height})},setPosition:function(x,y){w.css({left:x,top:y})},minimize:function(){toggleMinimize(w)},destroy:function(){w.remove(),delete s[i]}}}function makeDraggable(w,h){var d=!1,x,y,ix,iy;h.on('mousedown',function(e){if('BUTTON'===e.target.tagName)return;d=!0,ix=e.clientX-parseInt(w.css('left'),10),iy=e.clientY-parseInt(w.css('top'),10),$(document).on('mousemove.floating-drag',function(e){if(d){x=e.clientX-ix,y=e.clientY-iy;var ws=$('#red-ui-workspace'),wr=ws[0].getBoundingClientRect(),wcr=w[0].getBoundingClientRect();x=Math.max(0,Math.min(x,wr.width-wcr.width)),y=Math.max(0,Math.min(y,wr.height-32)),w.css({left:x+'px',top:y+'px'})}}),$(document).on('mouseup.floating-drag',function(){d=!1,$(document).off('.floating-drag')}),e.preventDefault()})}function makeResizable(w){var r=!1,sx,sy,sw,sh;w.on('mousedown',function(e){var rect=w[0].getBoundingClientRect(),ox=e.clientX-rect.left,oy=e.clientY-rect.top;if(ox>rect.width-12&&oy>rect.height-12){r=!0,sx=e.clientX,sy=e.clientY,sw=rect.width,sh=rect.height,$(document).on('mousemove.floating-resize',function(e){if(r){var nw=sw+(e.clientX-sx),nh=sh+(e.clientY-sy);nw=Math.max(200,nw),nh=Math.max(150,nh),w.css({width:nw+'px',height:nh+'px'})}}),$(document).on('mouseup.floating-resize',function(){r=!1,$(document).off('.floating-resize')}),e.preventDefault(),e.stopPropagation()}})}function setActiveWindow(w){$('.red-ui-floating-window').removeClass('active'),w.addClass('active'),w.css('z-index',++z),a=w}function toggleMinimize(w){var wd=s[w.attr('id')];wd.minimized?(w.removeClass('minimized'),w.css('height',wd.originalHeight||'400px'),wd.minimized=!1):(wd.originalHeight=w.css('height'),w.addClass('minimized'),wd.minimized=!0)}function enableFloatingMode(){$('body').addClass('red-ui-floating-mode')}function disableFloatingMode(){$('body').removeClass('red-ui-floating-mode')}return{create:createFloatingWindow,enableFloatingMode:enableFloatingMode,disableFloatingMode:disableFloatingMode,getActiveWindow:function(){return a},getAllWindows:function(){return s}}}();